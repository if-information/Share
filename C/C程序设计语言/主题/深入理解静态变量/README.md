## 深入理解静态变量

> C程序设计语言 (第2版 新版) [美]Brian W.Kernighan & Dennis M.Ritchie <br>
> _Page 70_

某些变量，比如文件 `stack.c` 中定义的变量 `sp` 与 `val` 以及文件 `getch.c` 中定义的变量 `buf` 与 `bufp`，它们仅供其所在的源文件中的函数使用，其他函数不能访问。用 `static` 声明限定外部变量与函数，可以将其后声明的对象的作用域限定为被编译源文件的剩余部分。通过`static` 限定外部对象，可以达到隐藏外部对象的目的，比如，`getch-ungetch` 复合结构需要共享 `buf` 与 `bufp` 两个变量，这样 `buf` 与 `bufp` 必须是外部变量，但这两个对象不应该被 `getch` 与 `ungetch` 函数的调用者所访问。

要将对象指定为静态存储，可以在正常的对象声明之前加上关键字 `static` 作为前缀。如果把上述两个函数和两个变量放在一个文件中编译，如下所示:
```C
static char buf[BUFSIZE]; /* ungetch函数使用的缓冲区 */
static int bufp = 0;	  /* 缓冲区buf的下一个空闲位置 */
 
int getch(void) { ... }
void ungetch(int c) { ... }
```
那么其他函数就不能访问变量 `buf` 与 `bufp` ，因此这两个名字不会和同一程序中的其他文件中的相同的名字相冲突。同样，可以通过把变量 `sp`
 与 `val` 声明为静态类型隐藏这两个由执行栈操作的 `push` 与 `pop` 函数使用的变量。

外部的 `static` 声明通常多用于变量，当然，它也可用于声明函数。通常情况下，函数名是全局可访问的，对整个程序的各个部分而言都可见。但是，如果把函数声明为 `static` 类型，则该函数名除了对该函数声明所在的文件可见外，其他文件都无法访问。

`static` 也可用于声明内部变量。`static` 类型的内部变量同自动变量一样，是某个特定函数的局部变量，只能在该函数中使用，但它与自动变量不同的是，不管其所在函数是否被调用，它一直存在，而不像自动变量那样，随着所在函数的被调用和退出而存在和消失。换句话说，`static` 类型的内部变量是一种只能在某个特定函数中使用但一直占据存储空间的变量







